# Playground - 認証機能付きWebアプリケーション

## 1. 概要

本プロジェクトでは、Next.js, TypeScript, Prismaを用いて、モダンでセキュアな認証・認可機能を持つWebアプリケーションを構築した。

基本的なユーザー認証フローに加え、ブルートフォース攻撃対策としてのアカウントロック機能、不正アクセスの確認としてログイン履歴の追跡、テーマカラーの変更機能などの機能を実装した。認証方式には、トークンベース認証を採用した。

## 2. アプリケーションのスクリーンショット


## 3. 実装機能一覧

### ■ 標準認証機能
- ユーザー登録（サインアップ）
- ログイン / ログアウト機能
- トークンベース認証 (JWTをHttpOnly Cookieに保存)

### ■ 追加実装機能 (セキュリティ & UX向上)
1.  **連続ログイン失敗によるアカウントロック機能**
2.  **パスワードの変更機能** (ログインユーザー限定)
3.  **ログイン履歴の表示機能** (ログインユーザー限定)
4.  **サインアップ時のパスワード確認機能**
5.  **パスワードの表示/非表示切り替え機能** (全てのフォームに実装)
6.  **動的テーマ変更機能** (ライト / ダーク / フューチャー)
7.  **ログイン後のリダイレクト機能** (保護されたページへのアクセス後、ログインすると元のページに戻る)

## 4. こだわりの実装詳細

本課題では、単に機能を実装するだけでなく、保守性、拡張性、そしてセキュリティを意識した設計を行いました。

### 4.1. 認証・認可の設計

#### トークンベース認証
ステートレスな特性を持つJWTを採用し、サーバーの負荷を軽減しつつ、将来的なサービスのスケールに対応可能な設計としました。認証トークンは、XSS攻撃のリスクを軽減するため、JavaScriptからアクセスできない**`HttpOnly`属性**を付与したCookieに保存しています。

#### 保護ルート（Protected Routes）
パスワード変更ページやログイン履歴ページなど、認証が必要なページは `/mypage` ディレクトリに集約しました。
`src/app/mypage/layout.tsx` が「門番」として機能し、未認証のユーザーからのアクセスを自動的にログインページへリダイレクトさせることで、コンポーネントレベルではなくレイアウトレベルでの堅牢なアクセス制御を実現しています。

```tsx:src/app/mypage/layout.tsx
'use client';

import { useAuth } from '@/app/_contexts/AuthContext';
// ...
export default function MypageLayout({ children }: { children: React.ReactNode }) {
  const { user, isLoading } = useAuth();
  // ...
  // 未ログインの場合、ログインページへリダイレクトさせる
  if (!user) {
    return (
      <main>
        {/* ...ログイン要求メッセージ... */}
      </main>
    );
  }
  // ログイン済みの場合はページ内容を表示
  return <>{children}</>;
}